<h1 class="mb-5">Budgets</h1>
<form class="card mb-3" [formGroup]="filterForm">
  <div
    class="card-header d-flex align-items-center justify-content-between"
    [class.collapsed]="filtersCollapsed"
    (click)="filtersCollapsed = !filtersCollapsed"
  >
    <h3 class="card-title mt-2">Filters</h3>
    <i
      class="bi-chevron-{{ filtersCollapsed ? 'down' : 'up' }}"
      [attr.aria-expanded]="!filtersCollapsed"
      (click)="filtersCollapsed = !filtersCollapsed"
    ></i>
  </div>
  <div
    class="card-body"
    id="filter-body"
    [collapse]="filtersCollapsed"
    [isAnimated]="true"
  >
    <div class="d-flex flex-column flex-lg-row gap-3">
      <div class="input-group">
        <i class="bi-search input-group-text"></i>
        <input
          type="text"
          class="form-control"
          placeholder="Search"
          aria-label="Search"
          [formControl]="searchControl"
        />
      </div>
      <input
        type="number"
        class="form-control"
        placeholder="Year"
        aria-label="Year"
        formControlName="year"
      />
      <div class="input-group">
        <i class="input-group-text bi-calendar"></i>
        <input
          type="text"
          class="form-control"
          placeholder="Dates"
          aria-label="Dates"
          bsDaterangepicker
          formControlName="date"
          [bsConfig]="rangePickerConfig"
        />
      </div>
      <button
        class="btn btn-danger align-self-end flex-shrink-1"
        type="reset"
        [disabled]="!filterForm.dirty"
      >
        Clear
      </button>
    </div>
  </div>
</form>
<div class="table-responsive">
  <table class="table table-hover table-borderless">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Start</th>
        <th scope="col">End</th>
        <th scope="col">
          <button class="btn btn-sm btn-outline-success" (click)="addBudget()">
            <i class="bi-plus"></i>
          </button>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="4" [hidden]="!loading">
          <div class="d-flex justify-content-center align-items-center gap-4">
            <h6 class="m-0">Loading...</h6>
            <div class="spinner-border text-primary">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </td>
      </tr>
      <tr
        *ngFor="let budget of budgets$ | async"
        [hidden]="loading"
        [routerLink]="[budget.id]"
      >
        <td>{{ budget.name }}</td>
        <td *ngIf="budget.startDate; else noStartDate">
          {{ budget.startDate | date }}
        </td>
        <ng-template #noStartDate>
          <td>N/A</td>
        </ng-template>
        <td *ngIf="budget.endDate; else noEndDate">
          {{ budget.endDate | date }}
        </td>
        <ng-template #noEndDate>
          <td>N/A</td>
        </ng-template>
        <td class="d-flex flex-row gap-2">
          <div dropdown container="body" placement="bottom right">
            <button
              class="btn btn-sm"
              dropdownToggle
              type="button"
              id="budget-{{ budget.id }}-action-btn"
              (click)="$event.cancelBubble = true"
              attr.aria-controls="budget-{{ budget.id }}-dropdown"
            >
              <i class="bi-three-dots-vertical"></i>
            </button>
            <ul
              *dropdownMenu
              id="budget-{{ budget.id }}-dropdown"
              class="dropdown-menu dropdown-menu-right"
              role="menu"
              attr.aria-labelledby="budget-{{ budget.id }}-action-btn"
            >
              <li role="menuitem">
                <button
                  type="button"
                  class="dropdown-item"
                  (click)="editBudget(budget)"
                >
                  <i class="bi-pencil me-1"></i>
                  Edit
                </button>
                <button type="button" class="dropdown-item text-danger">
                  <i class="bi-trash me-1"></i>
                  Delete
                </button>
              </li>
            </ul>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>
